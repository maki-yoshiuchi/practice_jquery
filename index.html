<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>郵便番号</title>
</head>

<body>
  <form>
    <table>
      <tr>
        <td>郵便番号</td>
        <td>
          <input type="text" class="zipcode">
        </td>
        <td>
          <button type="button" class="search_button" disabled="disabled">住所を探す</button>
        </td>
      </tr>
      <tr>
        <td>住所</td>
        <td colspan="2">
          <textarea class="address" rows="5" cols="30"></textarea>
        </td>
      </tr>
    </table>
  </form>
  <script src="https://code.jquery.com/jquery.min.js"></script>

  <script>
    $(function() {
      let inputZipcode;

      $('.zipcode').on('input', function() {
        inputZipcode = $('.zipcode').val().replace('-','');
        $('.address').val('');

        if ($.isNumeric(inputZipcode) && inputZipcode.length === 7) {
          $('.search_button').prop('disabled', false);
        } else {
          $('.search_button').prop('disabled', true);
        }
      });

      $('.search_button').on('click', function() {
        $.ajax({
          url: 'https://zipcloud.ibsnet.co.jp/api/search?zipcode=' + inputZipcode,
          type: 'GET',
        }).done(function(data) {
          const response = JSON.parse(data)
          if (response['results']) {
            $('.address').val(response['results'][0]['address1'] + response['results'][0]['address2'] + response['results'][0]['address3']);
          } else {
            alert('その郵便番号は存在しません');
          }
        }).fail(function() {
          alert('しばらく経ってからもう一度お試しください');
        });
      });
    });
  </script>
</body>
</html>